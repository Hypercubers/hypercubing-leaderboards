{{#> layouts/base.html}}
  {{#*inline "title"}}
    {{title}}
  {{/inline}}
  {{#*inline "content"}}

    {{#if (and active_user.moderator (or (and solve.speed_cs (eq null solve.speed_verified)) (and solve.move_count (eq null solve.fmc_verified))))}}
      <article>
        <span class="iconify" data-icon="mdi:security"></span>
        <a href="pending-submissions">
          <span class="iconify" data-icon="mdi:arrow-left"></span>
          Back to pending submissions
        </a>
        <br>
      </article>
    {{/if}}

    <div style="display: flex; justify-content: space-between">
      <h1>{{{title_html}}}</h1>

      {{#if can_edit}}
        <div>
          <a role="button" class="outline" href="/edit-solve?id={{solve.id}}">
            <span class="iconify" data-icon="mdi:pencil"></span>
            Edit
          </a>
        </div>
      {{/if}}
    </div>

    {{#if active_user.moderator}}
      <article>
        <form method="post" action="verify-solve" enctype="multipart/form-data" class="normalize-multipart">
          <input type="hidden" name="solve_id" value="{{solve.id}}" />
          <input name="audit_log_comment" placeholder="Add comment with verification…" autocomplete="off" style="width:25%" />
          {{#if solve.speed_cs}}
            <h3>
              Speed
              <fieldset role="group" style="width: auto; margin: 0em 0em 0em 1em;">
                <button name="speed" value="accept" class="secondary" {{#if (eq true solve.speed_verified)}}disabled{{/if}}><span class="iconify" data-icon="mdi:check"></span> Accept</button>
                <button name="speed" value="reject" class="secondary" {{#if (eq false solve.speed_verified)}}disabled{{/if}}><span class="iconify" data-icon="mdi:close"></span> Reject</button>
                <button name="speed" value="unverify" class="secondary" {{#if (eq null solve.speed_verified)}}disabled{{/if}}><span class="iconify" data-icon="mdi:timer"></span> Unverify</button>
              </fieldset>
            </h3>
          {{/if}}
          {{#if solve.move_count}}
            <h3 style="margin-bottom: 0rem;">
              Fewest-moves
              <fieldset role="group" style="width: auto; margin: 0em 0em 0em 1em;">
                <input style="width:25%" placeholder="Add comment…" />
                <button name="fmc" value="accept" class="secondary" {{#if (eq true solve.fmc_verified)}}disabled{{/if}}><span class="iconify" data-icon="mdi:check"></span> Accept</button>
                <button name="fmc" value="reject" class="secondary" {{#if (eq false solve.fmc_verified)}}disabled{{/if}}><span class="iconify" data-icon="mdi:close"></span> Reject</button>
                <button name="fmc" value="unverify" class="secondary" {{#if (eq null solve.fmc_verified)}}disabled{{/if}}><span class="iconify" data-icon="mdi:timer"></span> Unverify</button>
              </fieldset>
            </h3>
          {{/if}}
        </form>
        <span class="iconify" data-icon="mdi:security"></span>
        <a href="audit-log/solve?id={{solve.id}}">Audit log for this solve</a>
      </article>
    {{/if}}

    {{#if verification_message}}
      <h2>{{{verification_message}}}</h2>
    {{/if}}

    {{#if youtube_embed_code}}
      <iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/{{youtube_embed_code}}" allow="encrypted-media" allowfullscreen></iframe>
    {{/if}}

    <table>
      <tbody>
        <tr>
          <td>Solver</td>
          <td><a href="{{solver_url}}">{{solver_name}}</a></td>
        </tr>
        <tr>
          <td>Puzzle</td>
          <td>
            <a href="{{puzzle_url}}">{{puzzle_name}} ({{#unless solve.flags.filters}}no {{/unless}}filters, {{#unless solve.flags.macros}}no {{/unless}}macros{{#if solve.flags.computer_assisted}}, computer-assisted{{/if}})</a>
          </td>
        </tr>
        <tr>
          <td>Time</td>
          <td>
            {{#if (and show_speed solve.speed_cs)}}
              {{{render_time solve.speed_cs}}}
              {{#if solve.memo_cs}}
                <span data-tooltip="memorization time">
                  <small>[{{{render_time solve.memo_cs}}}]</small>
                </span>
              {{/if}}
              {{#if show_verification_status}}
                {{{render_verified solve.speed_verified}}}
              {{/if}}
            {{else}}
              -
            {{/if}}
          </td>
        </tr>
        <tr>
          <td>Move count</td>
          <td>
            {{#if (and show_fmc solve.move_count)}}
              {{solve.move_count}}
              {{#if show_verification_status}}
                {{{render_verified solve.fmc_verified}}}
              {{/if}}
            {{else}}
              -
            {{/if}}
          </td>
        </tr>
        <tr>
          <td>Solve date</td>
          <td>{{date solve.solve_date}}</td>
        </tr>
        <tr>
          <td>Upload date</td>
          <td>{{date solve.upload_date}}</td>
        </tr>
        <tr>
          <td>Program</td>
          <td>{{program}}</td>
        </tr>
        {{#if (and show_speed solve.video_url)}}
          <tr>
            <td>Video link</td>
            <td>{{#if trusted_video_url}}<a href="{{solve.video_url}}">{{solve.video_url}}</a>{{else}}{{solve.video_url}}{{/if}}</td>
          </tr>
        {{/if}}
        {{#if show_fmc}}
          <tr>
            <td>Log file</td>
            <td><a href="/solve-file?id={{solve.id}}" download="{{solve.log_file_name}}">{{solve.log_file_name}}</a></td>
          </tr>
        {{/if}}
        {{#if solver_notes_html}}
          <tr>
            <td>Solver notes</td>
            <td><article><pre>{{{solver_notes_html}}}</pre></article></td>
          </tr>
        {{/if}}
        {{#if (and active_user.moderator solve.moderator_notes)}}
          <tr>
            <td>Moderator notes</td>
            <td><article><pre>{{solve.moderator_notes}}</pre></article></td>
          </tr>
        {{/if}}
        {{#if (and active_user.moderator solve.log_file_name)}}
          <tr>
            <td>Auto verify output</td>
            <td>
              {{#if solve.auto_verify_output}}
                <article>
                  <details>
                    <summary>Click to show JSON</summary>
                    <pre>{{pretty_json solve.auto_verify_output}}</pre>
                  </details>
                </article>
              {{/if}}
              {{#if (or (not solve.speed_verified) (not solve.fmc_verified))}}
                <form method="post" action="request-autoverify" enctype="multipart/form-data" class="normalize-multipart">
                  <input type="hidden" name="solve_id" value="{{solve.id}}" />
                  <button class="secondary">Request auto-verification</button>
                  <small>Do not click this button multiple times</small>
                </form>
              {{/if}}
            </td>
          </tr>
        {{/if}}
      </tbody>
    </table>

    <h2>History</h2>
    <article>
      <span class="iconify" data-icon="mdi:security"></span>
      <a href="audit-log/solve?id={{solve.id}}">Audit log for this solve</a>
    </article>
    {{> components/audit-log-contents.html}}

  {{/inline}}
{{/layouts/base.html}}
